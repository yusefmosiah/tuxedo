/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain_core/_api/deprecation.py:26: UserWarning: Core Pydantic V1 functionality isn't compatible with Python 3.14 or greater.
  from pydantic.v1.fields import FieldInfo as FieldInfoV1
Traceback (most recent call last):
  File "/Users/wiz/tuxedo/backend/vibewriter/test_planning.py", line 19, in test_planning
    result = agent.invoke(task, config={"recursion_limit": 50})
  File "/Users/wiz/tuxedo/backend/vibewriter/agent.py", line 37, in invoke
    return self.graph.invoke({"messages": messages}, config=config)
           ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langgraph/pregel/main.py", line 3068, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<10 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langgraph/pregel/main.py", line 2643, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langgraph/pregel/_runner.py", line 167, in tick
    run_with_retry(
    ~~~~~~~~~~~~~~^
        t,
        ^^
    ...<10 lines>...
        },
        ^^
    )
    ^
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langgraph/pregel/_retry.py", line 42, in run_with_retry
    return task.proc.invoke(task.input, config)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langgraph/_internal/_runnable.py", line 656, in invoke
    input = context.run(step.invoke, input, config, **kwargs)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langgraph/_internal/_runnable.py", line 400, in invoke
    ret = self.func(*args, **kwargs)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain/agents/factory.py", line 1037, in model_node
    response = wrap_model_call_handler(request, _execute_model_sync)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain/agents/factory.py", line 171, in final_normalized
    final_result = result(request, handler)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain/agents/factory.py", line 155, in composed
    outer_result = outer(request, inner_handler)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain/agents/middleware/todo.py", line 206, in wrap_model_call
    return handler(request)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain/agents/factory.py", line 151, in inner_handler
    inner_result = inner(req, handler)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain/agents/factory.py", line 155, in composed
    outer_result = outer(request, inner_handler)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/deepagents/middleware/filesystem.py", line 763, in wrap_model_call
    return handler(request)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain/agents/factory.py", line 151, in inner_handler
    inner_result = inner(req, handler)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain/agents/factory.py", line 155, in composed
    outer_result = outer(request, inner_handler)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/deepagents/middleware/subagents.py", line 472, in wrap_model_call
    return handler(request.override(system_prompt=system_prompt))
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain/agents/factory.py", line 151, in inner_handler
    inner_result = inner(req, handler)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain_anthropic/middleware/prompt_caching.py", line 119, in wrap_model_call
    return handler(request.override(model_settings=new_model_settings))
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain/agents/factory.py", line 1007, in _execute_model_sync
    output = model_.invoke(messages)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain_core/runnables/base.py", line 5534, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain_core/language_models/chat_models.py", line 398, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain_core/language_models/chat_models.py", line 1117, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain_core/language_models/chat_models.py", line 927, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain_core/language_models/chat_models.py", line 1221, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain_anthropic/chat_models.py", line 1915, in _generate
    data = self._create(payload)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/langchain_anthropic/chat_models.py", line 1777, in _create
    return self._client.messages.create(**payload)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/anthropic/_utils/_utils.py", line 282, in wrapper
    return func(*args, **kwargs)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/anthropic/resources/messages/messages.py", line 930, in create
    return self._post(
           ~~~~~~~~~~^
        "/v1/messages",
        ^^^^^^^^^^^^^^^
    ...<26 lines>...
        stream_cls=Stream[RawMessageStreamEvent],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/anthropic/_base_client.py", line 1326, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/anthropic/_base_client.py", line 1035, in request
    request = self._build_request(options, retries_taken=retries_taken)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/anthropic/_base_client.py", line 506, in _build_request
    headers = self._build_headers(options, retries_taken=retries_taken)
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/anthropic/_base_client.py", line 447, in _build_headers
    self._validate_headers(headers_dict, custom_headers)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/wiz/tuxedo/backend/venv/lib/python3.14/site-packages/anthropic/_client.py", line 200, in _validate_headers
    raise TypeError(
        '"Could not resolve authentication method. Expected either api_key or auth_token to be set. Or for one of the `X-Api-Key` or `Authorization` headers to be explicitly omitted"'
    )
TypeError: "Could not resolve authentication method. Expected either api_key or auth_token to be set. Or for one of the `X-Api-Key` or `Authorization` headers to be explicitly omitted"
During task with name 'model' and id 'f972d8b2-4f1d-0ecf-433b-6b362e58934e'
Initializing Vibewriter Agent...
Task: Create a plan to write a haiku about coding and save it to a file named 'haiku.txt'.
Invoking agent (this may take a minute)...
Error during execution: "Could not resolve authentication method. Expected either api_key or auth_token to be set. Or for one of the `X-Api-Key` or `Authorization` headers to be explicitly omitted"
Cleaning up...
